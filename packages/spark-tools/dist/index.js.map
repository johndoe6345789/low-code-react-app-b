{"version":3,"file":"index.js","sources":["../src/hooks/index.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react'\n\n/**\n * useKV Hook - Persistent key-value storage with localStorage and window.spark.kv integration\n * \n * This hook provides persistent state management that syncs with localStorage\n * and integrates with the Spark KV storage system if available.\n * \n * @param key - Storage key\n * @param defaultValue - Default value if key doesn't exist\n * @returns Tuple of [value, setValue, deleteValue]\n */\nexport function useKV<T>(\n  key: string,\n  defaultValue: T\n): [T, (value: T | ((prev: T) => T)) => void, () => void] {\n  // Initialize state from localStorage or default value\n  const [value, setValueInternal] = useState<T>(() => {\n    try {\n      // Try to get from window.spark.kv first\n      if (typeof window !== 'undefined' && window.spark?.kv) {\n        const sparkValue = window.spark.kv.get(key)\n        if (sparkValue !== undefined) {\n          return sparkValue as T\n        }\n      }\n\n      // Fallback to localStorage\n      const item = localStorage.getItem(key)\n      return item ? JSON.parse(item) : defaultValue\n    } catch (error) {\n      console.error('Error reading from storage:', error)\n      return defaultValue\n    }\n  })\n\n  // Set value and sync to storage\n  const setValue = useCallback(\n    (newValue: T | ((prev: T) => T)) => {\n      try {\n        setValueInternal((prevValue) => {\n          const valueToStore =\n            typeof newValue === 'function'\n              ? (newValue as (prev: T) => T)(prevValue)\n              : newValue\n\n          // Store in localStorage\n          localStorage.setItem(key, JSON.stringify(valueToStore))\n\n          // Store in window.spark.kv if available\n          if (typeof window !== 'undefined' && window.spark?.kv) {\n            window.spark.kv.set(key, valueToStore)\n          }\n\n          return valueToStore\n        })\n      } catch (error) {\n        console.error('Error writing to storage:', error)\n      }\n    },\n    [key]\n  )\n\n  // Delete value from storage\n  const deleteValue = useCallback(() => {\n    try {\n      localStorage.removeItem(key)\n      if (typeof window !== 'undefined' && window.spark?.kv) {\n        window.spark.kv.delete(key)\n      }\n      setValueInternal(defaultValue)\n    } catch (error) {\n      console.error('Error deleting from storage:', error)\n    }\n  }, [key, defaultValue])\n\n  // Sync with localStorage changes from other tabs\n  useEffect(() => {\n    const handleStorageChange = (e: StorageEvent) => {\n      if (e.key === key && e.newValue !== null) {\n        try {\n          setValueInternal(JSON.parse(e.newValue))\n        } catch (error) {\n          console.error('Error parsing storage event:', error)\n        }\n      }\n    }\n\n    window.addEventListener('storage', handleStorageChange)\n    return () => window.removeEventListener('storage', handleStorageChange)\n  }, [key])\n\n  return [value, setValue, deleteValue]\n}\n"],"names":["useKV","key","defaultValue","value","setValueInternal","useState","window","spark","kv","sparkValue","get","undefined","item","localStorage","getItem","JSON","parse","error","console","setValue","useCallback","newValue","prevValue","valueToStore","setItem","stringify","set","deleteValue","removeItem","delete","useEffect","handleStorageChange","e","addEventListener","removeEventListener"],"mappings":"4HAYM,SAAUA,EACdC,EACAC,GAGA,MAAOC,EAAOC,GAAoBC,EAAY,KAC5C,IAEE,GAAsB,oBAAXC,QAA0BA,OAAOC,OAAOC,GAAI,CACrD,MAAMC,EAAaH,OAAOC,MAAMC,GAAGE,IAAIT,GACvC,QAAmBU,IAAfF,EACF,OAAOA,CAEX,CAGA,MAAMG,EAAOC,aAAaC,QAAQb,GAClC,OAAOW,EAAOG,KAAKC,MAAMJ,GAAQV,CACnC,CAAE,MAAOe,GAEP,OADAC,QAAQD,MAAM,8BAA+BA,GACtCf,CACT,IAIIiB,EAAWC,EACdC,IACC,IACEjB,EAAkBkB,IAChB,MAAMC,EACgB,mBAAbF,EACFA,EAA4BC,GAC7BD,EAUN,OAPAR,aAAaW,QAAQvB,EAAKc,KAAKU,UAAUF,IAGnB,oBAAXjB,QAA0BA,OAAOC,OAAOC,IACjDF,OAAOC,MAAMC,GAAGkB,IAAIzB,EAAKsB,GAGpBA,GAEX,CAAE,MAAON,GACPC,QAAQD,MAAM,4BAA6BA,EAC7C,GAEF,CAAChB,IAIG0B,EAAcP,EAAY,KAC9B,IACEP,aAAae,WAAW3B,GACF,oBAAXK,QAA0BA,OAAOC,OAAOC,IACjDF,OAAOC,MAAMC,GAAGqB,OAAO5B,GAEzBG,EAAiBF,EACnB,CAAE,MAAOe,GACPC,QAAQD,MAAM,+BAAgCA,EAChD,GACC,CAAChB,EAAKC,IAkBT,OAfA4B,EAAU,KACR,MAAMC,EAAuBC,IAC3B,GAAIA,EAAE/B,MAAQA,GAAsB,OAAf+B,EAAEX,SACrB,IACEjB,EAAiBW,KAAKC,MAAMgB,EAAEX,UAChC,CAAE,MAAOJ,GACPC,QAAQD,MAAM,+BAAgCA,EAChD,GAKJ,OADAX,OAAO2B,iBAAiB,UAAWF,GAC5B,IAAMzB,OAAO4B,oBAAoB,UAAWH,IAClD,CAAC9B,IAEG,CAACE,EAAOgB,EAAUQ,EAC3B"}